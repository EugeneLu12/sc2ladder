{% extends "base.html" %}

{% block css %}
  <link rel="stylesheet" href="{{ static('css/search.css') }}">
  <link rel="stylesheet" href="{{ static('css/navbar.css') }}">
{% endblock %}

{% block content %}
{% if pages_required > -1 %}
  <table class="filter">
    <tr>
      <th>Sort By:</th>
      {% if sort == 'mmr' %}
        <td class="isActive">MMR</td>
      {% else %}
        <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort=mmr&page=1">MMR</a></td>
      {% endif %}
      {% if sort == 'rank' %}
        <td class="isActive">Rank</td>
      {% else %}
        <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort=rank&page=1">Rank</a></td>
      {% endif %}
      <th>Region:</th>
      {% if region == 'all' %}
        <td class="isActive">all</td>
      {% else %}
        <td><a href="?region=all&rank={{ rank_filter }}&sort={{ sort }}&page=1">all</a></td>
      {% endif %}
      {% if region == 'us' %}
        <td class="isActive">NA</td>
      {% else %}
        <td><a href="?region=us&rank={{ rank_filter }}&sort={{ sort }}&page=1">NA</a></td>
      {% endif %}
      {% if region == 'eu' %}
        <td class="isActive">EU</td>
      {% else %}
        <td><a href="?region=eu&rank={{ rank_filter }}&sort={{ sort }}&page=1">EU</a></td>
      {% endif %}
      {% if region == 'kr' %}
        <td class="isActive">KR</td>
      {% else %}
        <td><a href="?region=kr&rank={{ rank_filter }}&sort={{ sort }}&page=1">KR</a></td>
      {% endif %}
      <th>Rank:</th>
      {% if rank_filter == 'all' %}
        <td class="isActive">all</td>
      {% else %}
        <td><a href="?region={{ region }}&rank=all&&sort={{ sort }}&page=1">all</a></td>
      {% endif %}
      {% for rank in ranks %}
        {% if rank == rank_filter %}
          <td class="isActive"><img src="static/assets/img/{{ rank }}.png" class="icon"></td>
        {% else %}
          <td><a href="?region={{ region }}&rank={{ rank }}&sort={{ sort }}&page=1"><img src="static/assets/img/{{ rank }}.png" class="icon"></a></td>
        {% endif %}
      {% endfor %}
      <th class="reset"><a href="?region=all&rank=all&sort=mmr&page=1">Reset Filters</a></th>
    </tr>
  </table>
  <table class="resultsTable">
    <thead>
      <tr>
        <th>Region</th>
        <th>Rank</th>
        <th>Character Name</th>
        <th>Battle Net ID</th>
        <th>Race</th>
        <th>MMR</th>
        <th>Wins</th>
        <th>Losses</th>
      </tr>
    </thead>
    <tbody>
      {% for player in players %}
        <tr>
          <td>{{ player.region }}</td>
          <td><img src="static/assets/img/{{ player.rank }}.png" class="icon"></td>
          <td>{% if player.clan %}[{{ player.clan }}]{% endif %}{{ player.username[:player.username.index('#')] }}</td>
          <td>{{ player.bnet_id }}</td>
          <td><img src="static/assets/img/{{ player.race }}.png" class="icon"></td>
          <td>{{ player.mmr }}</td>
          <td>{{ player.wins }}</td>
          <td>{{ player.losses }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <table class="footer">
    <tr>
        {% if pages_required > 12 %}
          {% if page_number < 8 %}
            {% for i in range(0, page_number + 4) %}
              {% if i + 1 == page_number %}
                <td id="onPage">{{ i + 1 }}</td>
              {% else %}
                <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort={{ sort }}&page={{ i + 1 }}">{{ i + 1 }}</a></td>
            {% endif %}
            {% endfor %}
            <td>...</td>
            {% for i in range(pages_required - 4, pages_required) %}
              <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort={{ sort }}&page={{ i + 1 }}">{{ i + 1 }}</a></td>
            {% endfor %}
          {% elif page_number < pages_required - 8 %}
            {% for i in range(0, 4) %}
              <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort={{ sort }}&page={{ i + 1 }}">{{ i + 1 }}</a></td>
            {% endfor %}
            <td>...</td>
            {% for i in range(page_number - 4, page_number + 3) %}
              {% if i + 1 == page_number %}
                <td id="onPage">{{ i + 1 }}</td>
              {% else %}
                <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort={{ sort }}&page={{ i + 1 }}">{{ i + 1 }}</a></td>
              {% endif %}
            {% endfor %}
            <td>...</td>
            {% for i in range(pages_required - 4, pages_required) %}
              <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort={{ sort }}&page={{ i + 1 }}">{{ i + 1 }}</a></td>
            {% endfor %}
          {% else %}
            {% for i in range(0, 4) %}
              <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort={{ sort }}&page={{ i + 1 }}">{{ i + 1 }}</a></td>
            {% endfor %}
            <td>...</td>
            {% for i in range(page_number - 4, pages_required) %}
              {% if i + 1 == page_number %}
                <td id="onPage">{{ i + 1 }}</td>
              {% else %}
                <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort={{ sort }}&page={{ i + 1 }}">{{ i + 1 }}</a></td>
            {% endif %}
            {% endfor %}
          {% endif %}
        {% else %}
          {% for i in range(0, pages_required) %}
            {% if i + 1 == page_number %}
              <td id="onPage">{{ i + 1 }}</td>
            {% else %}
              <td><a href="?region={{ region }}&rank={{ rank_filter }}&sort={{ sort }}&page={{ i + 1 }}">{{ i + 1 }}</a></td>
            {% endif %}
          {% endfor %}
        {% endif %}
      </tr>
    </table>
  {% else %}
  <table class="resultsTable">
    <tr><td><h1>No results found!</h1></td></tr>
  </table>
  {% endif %}
{% endblock %}

{% block scripts %}
  <script src="{{ static('js/search.js') }}"></script>
  <script src="{{ static('js/navBar.js') }}"></script>
{% endblock %}
</html>
